<html>
  <head>
    <!-- Main app stylesheet-->
    <link rel="stylesheet" href="css/app.css">
    <!-- Material Design Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Vue.JS -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  </head>
  <body>
    <div id="vm">
      <div class="nav dark-grey white--text">
          <a class="nav-item selectable--text" @click="fileMenu" ref="btnFile" id="fm">File</a>
          <img src="img/nav_separator.svg" class="nav-item cursor-default">
          <template v-if="isEnterSubjectOpen || isLoadExperimentOpen">
            <a class="nav-item selectable--text disabled--text">Settings</a>
          </template>
          <template v-else>
            <a class="nav-item selectable--text" @click="settingsOpen">Settings</a>
          </template>
          <img src="img/nav_separator.svg" class="nav-item cursor-default">
          <template v-if="isExperimentLoaded">
            <a class="nav-item"><strong>Experiment:</strong> {{experiment.name}}</a>
          </template>
          <template v-else>
            <a class="nav-item"><strong>Experiment:</strong> None Loaded</a>
          </template>
          <h2 class="yellow--text nav-item--push cursor-default"><strong>Alcolator</strong></h2>
          <img src="img/nav_separator.svg" class="nav-item cursor-default" style="opacity: 0.2">
          <i class="material-icons nav-icon nav-item selectable--text" style="margin-bottom: 6px;">minimize</i>
          <i class="material-icons nav-icon nav-item selectable--text" style="margin-right: 9px;" @click="winClose">close</i>
      </div>
      <div class="flexbox-row">
        <div class="flexbox-column--list light-grey">
          <div class="flexbox-row--align">
            <strong><h2 style="margin: 10px;">Records</h2></strong>
          </div>   
          <div class="vertical-scroll">
            <record
              v-for="record in records"
              v-bind:key="record.id"
              v-bind:record="record"
              v-bind:class="{draft: record.subject_code == draft.subject_code}"
              @click.native="recordClick($event, record)">
            </record>
          </div>
        </div>
        <div class="flexbox-column--dat pad--10px">
          <template v-if="isNewStart">
            <h3 style="margin-top: 15px; margin-left: 15px; margin-bottom: 0;">Please select an operation.</h3>
            <div class="flexbox-row pad--10px" style="height: 63%;"></div>
          </template>
          <template v-else>
            <template v-if="isViewingSubject">
              <strong><h4 style="margin-top: 15px; margin-left: 15px; margin-bottom: 0;">Viewing Subject {{selected.subject_code}}</h4></strong>
            </template>
            <template v-else-if="isBacMode">
              <strong><h4 style="margin-top: 15px; margin-left: 15px; margin-bottom: 0;">Subject {{selected.subject_code}} - In Progress</h4></strong>
            </template>
            <template v-else>
              <strong><h4 style="margin-top: 15px; margin-left: 15px; margin-bottom: 0;">New Subject {{selected.subject_code}}</h4></strong>
            </template>
            <div class="flexbox-row pad--10px" style="height: 63%;">
              <div class="flexbox-column" style="width: 50%;">
                <h3 class="margin-tb--10px"><strong>General Information</strong></h3>
                <div class="flexbox-row--alignright margin-tb--13px">
                  <h3 class="margin-input input-label semibold">Age (years): </h3>
                  <template v-if="isViewingSubject">
                    <input readonly class="locked-grey border--black regular--dat" type="text" id="age" v-model="selected.age">
                    <i class="material-icons lock">lock</i>
                  </template>
                  <template v-else-if="isBacMode">
                    <input readonly class="locked-grey border--black regular--dat" type="text" id="age" v-model="draft.age">
                    <i class="material-icons lock">lock</i>
                  </template>
                  <template v-else>
                    <input class="light-grey border--black regular--dat" type="text" id="age" v-model="draft.age">
                  </template>
                </div>
                <div class="flexbox-row--alignright margin-tb--13px">
                  <h3 class="margin-input input-label semibold">Gender: </h3>
                  <template v-if="isViewingSubject">
                    <input readonly class="locked-grey border--black regular--dat" type="text" id="gender" v-model="selected.gender">
                    <i class="material-icons lock">lock</i>
                  </template>
                  <template v-else-if="isBacMode">
                    <input readonly class="locked-grey border--black regular--dat" type="text" id="gender" v-model="draft.gender">
                    <i class="material-icons lock">lock</i>
                  </template>
                  <template v-else>
                    <div class="dropdown">
                      <template v-if="draft.gender != ''">
                        <button class="dropdown-btn regular--dat light-grey" style="width: 88.9%; padding-top: 0; padding-bottom: 0; padding-left: 8px; padding-right: 0; border-radius: 0px; text-align: left; font-size: 12pt;">
                            {{draft.gender}}
                        </button>
                      </template>
                      <template v-else>
                        <button class="dropdown-btn regular--dat light-grey" style="width: 88.9%; padding-top: 0; padding-bottom: 0; padding-left: 8px; padding-right: 0; border-radius: 0px; text-align: left; font-size: 12pt;">
                            Select
                        </button>                 
                      </template>
                    <div class="dropdown-content light-grey--notopaque" style="min-width: 88%;" id="dropContent">
                      <dropdown
                        v-bind:key="1"
                        v-bind:obj="gender_male"
                        @click.native="setGender($event, gender_male.name)">
                      </dropdown>
                      <dropdown
                        v-bind:key="2"
                        v-bind:obj="gender_female"
                        @click.native="setGender($event, gender_female.name)">
                      </dropdown>
                    </div>
                  </template>
                </div>
                <div class="flexbox-row--alignright margin-tb--13px">
                  <h3 class="margin-input input-label semibold">Height (cm): </h3>
                  <template v-if="isViewingSubject">
                    <input readonly class="locked-grey border--black regular--dat" type="text" id="height" v-model="selected.height">
                    <i class="material-icons lock">lock</i>
                  </template>
                  <template v-else-if="isBacMode">
                    <input readonly class="locked-grey border--black regular--dat" type="text" id="height" v-model="draft.height">
                    <i class="material-icons lock">lock</i>
                  </template>
                  <template v-else>
                    <input class="light-grey border--black regular--dat" type="text" id="height" v-model="draft.height">
                  </template>
                </div>
                <div class="flexbox-row--alignright margin-tb--13px">
                  <h3 class="margin-input input-label semibold">Weight (kg): </h3>
                  <template v-if="isViewingSubject">
                    <input readonly class="locked-grey border--black regular--dat" type="text" id="weight" v-model="selected.weight">
                    <i class="material-icons lock">lock</i>
                  </template>
                  <template v-else-if="isBacMode">
                    <input readonly class="locked-grey border--black regular--dat" type="text" id="weight" v-model="draft.weight">
                    <i class="material-icons lock">lock</i>
                  </template>
                  <template v-else>
                    <input class="light-grey border--black regular--dat" type="text" id="weight" v-model="draft.weight">
                  </template>
                </div>
              </div>
              <div class="flexbox-column" style="width: 50%;">
                <h3 class="margin-tb--10px"><strong>Calculate Target Consumption</strong></h3>
                <div class="flexbox-row--alignright margin-tb--13px">
                  <h3 class="margin-input input-label semibold">Target BAC: </h3>
                  <template v-if="isViewingSubject">
                    <input readonly class="locked-grey border--black regular--dat" type="text" id="targetBAC" v-model="selected.target_bac">
                  <i class="material-icons lock">lock</i>
                  </template>
                  <template v-else-if="isBacMode">
                    <input readonly class="locked-grey border--black regular--dat" type="text" id="targetBAC" v-model="draft.target_bac">
                  <i class="material-icons lock">lock</i>
                  </template>
                  <template v-else>
                    <input class="light-grey border--black regular--dat" type="text" id="targetBAC" v-model="draft.target_bac">
                  </template>
                </div>
                <div class="flexbox-row--alignright margin-tb--13px">
                  <h3 class="margin-input input-label semibold">Reach in: </h3>
                  <template v-if="isViewingSubject">
                    <input readonly class="locked-grey border--black regular--dat" type="text" id="bacReachTime" v-model="selected.target_bac_time">
                    <i class="material-icons lock">lock</i>
                  </template>
                  <template v-else-if="isBacMode">
                    <input readonly class="locked-grey border--black regular--dat" type="text" id="bacReachTime" v-model="draft.target_bac_time">
                    <i class="material-icons lock">lock</i>
                  </template>
                  <template v-else>
                    <input class="light-grey border--black regular--dat" type="text" id="bacReachTime" v-model="draft.target_bac_time">
                  </template>
                </div>
                <div class="flexbox-row--alignright margin-tb--13px">
                  <template v-if="isViewingSubject">
                    <h3 class="margin-input input-label semibold">Recorded at: </h3>
                    <input readonly class="locked-grey border--black regular--dat" type="text" id="timeRecorded" v-model="selected.actual_bac_time">
                    <i class="material-icons lock">lock</i>
                  </template>
                  <template v-else-if="isBacMode">
                    <h3 class="margin-input input-label semibold">Actual BAC: </h3>
                    <input class="light-grey border--black regular--dat" type="text" id="bacActual" v-model="draft.actual_bac">
                  </template>
                  <template v-else>
                    <h3 class="margin-input input-label semibold">Measure in: </h3>
                    <div class="dropdown">
                      <template v-if="draft.beverage_name != ''">
                        <button class="dropdown-btn regular--dat light-grey" style="width: 88.9%; padding-top: 0; padding-bottom: 0; padding-left: 8px; padding-right: 0; border-radius: 0px; text-align: left; font-size: 12pt;">
                            {{draft.beverage_name}}
                        </button>
                      </template>
                      <template v-else>
                        <button class="dropdown-btn regular--dat light-grey" style="width: 88.9%; padding-top: 0; padding-bottom: 0; padding-left: 8px; padding-right: 0; border-radius: 0px; text-align: left; font-size: 12pt;">
                            Select
                        </button>                 
                      </template>
                    <div class="dropdown-content light-grey--notopaque" style="min-width: 88.3%;" id="dropContent">
                      <dropdown
                        v-for="beverage in beverages"
                        v-bind:key="beverage.id"
                        v-bind:obj="beverage"
                        @click.native="chooseBeverageSubject($event, beverage)">
                      </dropdown>
                    </div>
                  </template>
                </div>
                <template v-if="isViewingSubject">
                  <div class="flexbox-row--alignright margin-tb--13px">
                    <h3 class="margin-input input-label semibold">Actual BAC: </h3>
                    <input readonly class="locked-grey border--black regular--dat" type="text" id="bacActual" v-model="selected.actual_bac">
                    <i class="material-icons lock">lock</i>
                  </div>
                </template>
                <template v-else-if="isBacMode">
                  <div class="flexbox-row--alignright margin-tb--13px" style="justify-content: flex-end;">
                    <button class="normal red white--text selectable" style="margin-right: 25px;" id="recordBAC" @click="bacRecord">Record Actual BAC</button>
                  </div>                
                </template>
                <template v-else>
                  <div class="flexbox-row--alignright margin-tb--13px" style="justify-content: flex-end;">
                    <button class="normal dark-grey white--text selectable" style="margin-right: 25px; width: 172px;" id="cancel" @click="cancelSubject">Cancel</button>
                    <button class="normal red white--text selectable" style="margin-right: 25px;" id="calculate" @click="calculateClick">Calculate</button>
                  </div>
                </template>
              </div>
            </div>
          </template>
          
          <div class="flexbox-column light-grey" style="height: 37%;">
            <strong><h2 style="margin: 5px;">Results</h2></strong> 
            <div class="flexbox-row--alignleft" style="align-items: flex-end; margin-left: 10px; margin-top: 10%; width: 76%;">
              <template v-if="isCalculateClicked">
                <p>
                  GIVE <strong>SUBJECT {{draft.subject_code}}</strong> {{draft.amount_grams}} grams of alcohol as {{draft.amount_beverage}} ml 
                  of {{draft.beverage_name.toLowerCase()}} to reach a blood alcohol concentration of {{draft.target_bac}}% in {{draft.target_bac_time}} hours.
                  <br><br>
                  Click ADMINISTERED after giving subject calculated amount.
                </p>
              </template>
              <template v-else-if="isBacMode">
                <p>
                <strong>SUBJECT {{draft.subject_code}}</strong> administered {{draft.amount_grams}} grams of alcohol targeting
                  a blood alcohol concentration of {{draft.target_bac}}% in {{draft.target_bac_time}} hours.
                </p>
              </template>
              <template v-else-if="isViewingSubject">
                <p>
                  <strong>SUBJECT {{selected.subject_code}}</strong> administered {{selected.amount_grams}} grams of alcohol targeting
                  a blood alcohol concentration of {{selected.target_bac}}% in {{selected.target_bac_time}} hours.
                  <br><br>
                  Actual BAC recorded was {{selected.actual_bac}}% read at {{selected.actual_bac_time}}.
                </p>
              </template>
            </div>                 
            <div class="flexbox-row--alignleft" style="align-self: flex-end; margin-bottom: 0px;">
              <template v-if="isCalculateClicked">
                <button class="dark-grey white--text selectable" style="align-self: flex-end; margin-bottom: 20px; margin-top: 0; margin-left: 20px;" id="administer" @click="administeredClick">Administered</button>
              </template>
              <template v-else-if="isViewingSubject">
                <button class="dark-grey white--text selectable" style="align-self: flex-end; margin-bottom: 20px; margin-top: 0; margin-left: 20px;" id="pdfRep">Download PDF Report</button>
              </template>                    
              <img src="img/bottle.png" alt="beer bottle" class="nav-item--push" style="align-self: flex-end; margin-bottom: 0; margin-right: 20px;" width="209px" height="145px">
            </div>   
          </div>
        </div>
        <div class="file-menu white" v-bind:class="{show: isFileMenuOpen === true}" ref="menuFile">
          <div class="flexbox-column">
            <template v-if="isSettingsMenuOpen || isEnterSubjectOpen || isLoadExperimentOpen || (draft.subject_code != '')">
              <h6 class="file-menu--text disabled--text">New Subject</h6>
              <hr class="menu-sep" align="center">
              <h6 class="file-menu--text disabled--text">Load Experiment</h6>
            </template>
            <template v-else>
              <template v-if="isExperimentLoaded">
                <h6 class="file-menu--text selectable--text" @click="fileNewSubject">New Subject</h6>
              </template>
              <template v-else>
                <h6 class="file-menu--text disabled--text">New Subject</h6>
              </template>
              <hr class="menu-sep" align="center">
              <h6 class="file-menu--text selectable--text" @click="fileLoadExp">Load Experiment</h6>
            </template>
            <!--<h6 class="file-menu--text selectable--text" @click="fileNew">New Experiment</h6>-->
            <hr class="menu-sep" align="center">
            <h6 class="file-menu--text selectable--text" @click="fileLogOut">Log Out</h6>
            <h6 class="file-menu--text selectable--text" @click="winClose">Exit</h6>
          </div>
        </div>
        <div class="modal" v-bind:class="{show: isEnterSubjectOpen === true}">
          <div class="modal--input white">
            <h1 style="font-size: 24px; margin: 0;">New Subject</h1>
            <input v-model="draft.subject_code" class="light-grey border--black regular" type="text" id="subID" style="margin-top: 15px" placeholder=" Identification code">
            <div class="flexbox-row--align" style="margin-top: 15px; margin-left: 20px; width: 100%;">
              <template v-if="draft.subject_code != ''">
                <button class="dark-grey white--text selectable" style="margin-right: 5px;" @click="newSubject">Proceed</button>
              </template>
              <template v-else>
                <button class="dark-grey white--text disabled" style="margin-right: 5px;">Proceed</button>
              </template>
              <button class="red white--text selectable" style="margin-left: 5px; margin-right: 50px;" @click="newSubjectClose">Cancel</button>
            </div>
          </div>
        </div>
        <div class="modal" v-bind:class="{show: isLoadExperimentOpen === true}">
          <div class="modal--input white">
            <h1 style="font-size: 24px; margin: 0;">Load Experiment</h1>
            <div class="dropdown">
                <template v-if="experiment.id != null">
                  <button class="dropdown-btn light-grey" style="margin-top: 15px; padding-top: 0; padding-bottom: 0; padding-left: 8px; padding-right: 0; border-radius: 0px; text-align: left; font-size: 12pt;">
                      {{experiment.name}}
                  </button>
                </template>
                <template v-else>
                  <button class="dropdown-btn light-grey" style="margin-top: 15px; padding-top: 0; padding-bottom: 0; padding-left: 8px; padding-right: 0; border-radius: 0px; text-align: left; font-size: 12pt;">
                      Select experiment
                  </button>                 
                </template>
              <div class="dropdown-content light-grey--notopaque" style="min-width: 94.25%;" id="dropContent">
                <dropdown
                  v-for="experiment in experiments"
                  v-bind:key="experiment.id"
                  v-bind:obj="experiment"
                  @click.native="chooseExperiment($event, experiment)">
                </dropdown>
              </div>
            </div>	
            <div class="flexbox-row--align" style="margin-top: 15px; margin-left: 20px; width: 100%;">
              <template v-if="experiment.id != null">
                <button class="dark-grey white--text selectable" style="margin-right: 5px;" @click="loadExp">Load</button>
              </template>
              <template v-else>
                <button class="dark-grey white--text disabled" style="margin-right: 5px;">Load</button>
              </template>
              <button class="red white--text selectable" style="margin-left: 5px; margin-right: 50px;" @click="loadExpClose">Cancel</button>
            </div>
          </div>
        </div>
        <div class="modal" v-bind:class="{show: isSettingsMenuOpen === true}">
          <div class="modal--settings white">
            <h1 style="font-size: 28px; margin: 0;">Settings</h1>
            <h3 class="semibold" style="font-size: 18px; margin-bottom: 30px;"><strong>Currently Logged-In:</strong> Jane Doe</h3>
            <h2 style="font-weight: bold; margin-bottom: 10px;">Beverages</h2>
            <div class="flexbox-row">
              <div class="flexbox-column" style="width: 50%; padding-right: 30px;">
                <h3 style="font-size: 18px; font-weight: bold; margin: 0;">Add New Beverage: </h3>
                <div class="flexbox-row--alignleft margin-tb--10px">
                  <h3 class="margin-input input-label semibold">Name: </h3>
                  <input class="light-grey border--black regular short" type="text" id="newBevName" v-model="settingsBeverage.newName">
                </div>
                <div class="flexbox-row--alignleft margin-tb--10px">
                  <h3 class="margin-input input-label semibold">Alc. %: </h3>
                  <input class="light-grey border--black regular short" type="text" id="newBevConc" v-model="settingsBeverage.newConc">
                </div>
              </div>
              <div class="flexbox-column" style="padding-right: 30px;">
                <h3 style="font-size: 18px; font-weight: bold; margin: 0;">Change Alc. %: </h3>
                <div class="flexbox-row--alignleft margin-tb--10px">
                  <h3 class="margin-input input-label semibold">Select: </h3>
                  <div class="dropdown short">
                    <template v-if="settingsBeverage.id != null">
                      <button class="dropdown-btn light-grey" style="width: 150px; padding-top: 0; padding-bottom: 0; padding-left: 8px; padding-right: 0; border-radius: 0px; text-align: left; font-size: 12pt;">
                          {{settingsBeverage.name}}
                      </button>
                    </template>
                    <template v-else>
                      <button class="dropdown-btn light-grey" style="width: 150px; padding-top: 0; padding-bottom: 0; padding-left: 8px; padding-right: 0; border-radius: 0px; text-align: left; font-size: 12pt;">
                          Select
                      </button>                 
                    </template>
                  <div class="dropdown-content light-grey--notopaque" style="min-width: 96.75%;" id="dropContent">
                    <dropdown
                      v-for="beverage in beverages"
                      v-bind:key="beverage.id"
                      v-bind:obj="beverage"
                      @click.native="chooseBeverage($event, beverage)">
                    </dropdown>
                  </div>
                </div>	
                </div>
                <div class="flexbox-row--alignleft margin-tb--10px">
                  <h3 class="margin-input input-label semibold">Alc. %: </h3>
                  <input class="light-grey border--black regular short" type="text" id="changeBevConc" v-model="settingsBeverage.concentration">
                </div>
                <div class="flexbox-row--align" style="margin-top: 20px; margin-left: 20px; width: 100%;">
                  <template v-if="settingsBeverage.id != null || settingsBeverage.newName != '' || settingsBeverage.newConc != '' || settingsBeverage.concentration != ''">
                    <button class="dark-grey white--text selectable" style="margin-right: 5px;" @click="settingsSave">Save</button>
                  </template>
                  <template v-else>
                    <button class="dark-grey white--text disabled" style="margin-right: 5px;">Save</button>
                  </template>
                  <button class="red white--text selectable" style="margin-left: 5px;" @click="settingsClose">Close</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
  <!-- Page Script -->
  <script src="js/main.js"></script>
</html>
